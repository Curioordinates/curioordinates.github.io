<html>
  <head>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <style>
      #map {
        height: 100%;
      }
    </style>
    <script>
      const qs = {};
      const parseLocation = () => {
        const url = window.location.href;
        console.log(url);
        const i = url.indexOf("?");

        if (i !== -1) {
          qs.follow = url.toLowerCase().indexOf("follow") != -1; // Map point updates.
          url
            .substring(i + 1)
            .split("&")
            .forEach((pair) => {
              const [k, v] = pair.split("=");
              qs[k] = v;
              if (k === "l" || k === "p") {
                const ll = v.split(",");
                qs.latitude = Number(`${ll[0]}`.trim()) || 0;
                qs.longitude = Number(`${ll[1]}`.trim()) || 0;
              }
            });
        }
        console.log(qs);
      };

      const anchor = { iconAnchor: [28, 44] };
      const createMarker = (iconUrl) => {
        return L.icon({
          iconUrl,
          iconSize: [57, 57], // size of the icon
          ...anchor,
          popupAnchor: [-3, -76], // point from which the popup should open relative to the iconAnchor
        });
      };

      const setup = () => {
        parseLocation();
        const maxMapZoom = 19;

        var Gr = createMarker("./markers/Gr.png");
        var Site = createMarker("./markers/Site.png");
        var Uf = createMarker("./markers/Uf.png");
        var Hf = createMarker("./markers/Hf.png");
        var Cm = createMarker("./markers/Cm.png");
        var Mc = createMarker("./markers/Mc.png");
        var Ss = createMarker("./markers/Ss.png");
        var Sm = createMarker("./markers/Sm.png");
        var Mx = createMarker("./markers/Mx.png");

        var map = L.map("map");
        if (!qs.latitude && !qs.longitude) {
          map.locate({ setView: true, maxZoom: maxMapZoom, watch: qs.follow }); //watch=live
        } else {
          map.setView([qs.latitude, qs.longitude], qs.z ?? 14);
        }

        const thunderForest = [
          "https://{s}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey={apikey}",
          {
            attribution:
              '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            apikey: "0197383662634b97a16e61e0915ab4be", // Yes, you can grab this key but I'm on the free account!
            maxZoom: 22,
          },
        ];

        const thunderForestTransport = [
          "https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey={apikey}",
          {
            attribution:
              '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            apikey: "0197383662634b97a16e61e0915ab4be", // Yes, you can grab this key but I'm on the free account!
            maxZoom: 22,
          },
        ];

        const stadiaSmooth = [
          "https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png?api_key={api_key}",
          {
            maxZoom: 20,
            api_key: "7f608bb5-d5f7-43c2-a9e4-8b919e3531db",
            attribution:
              '&copy; <a href="https://stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>',
          },
        ];

        const tileLayer = stadiaSmooth;

        // providers demo: https://leaflet-extras.github.io/leaflet-providers/preview/
        L.tileLayer(...tileLayer).addTo(map);

        L.marker([51.26828, 1.17133], { icon: Gr }).addTo(map); // southend https://www.monumentaltrees.com/en/gbr/england/kent/24257_leepriory/
        L.marker([-35.61027, 148.09193], { icon: Gr }).addTo(map); // AUS https://www.monumentaltrees.com/en/aus/mainland/newsouthwales/13767_lochinvarpark/
        L.marker([41.68813, 22.81003], { icon: Gr }).addTo(map); //   MKD Gr https://www.monumentaltrees.com/en/mkd/eastern/berovo/23204_school/
        L.marker([52.6416, 1.31319], { icon: Gr }).addTo(map); // mousehold Gr
        L.marker([52.64313, 1.35729], { icon: Gr }).addTo(map); // poundlane Gr

        L.marker([52.9769, 0.5419], { icon: Site }).addTo(map); // fake seahenge

        L.marker([51.5346703, -0.0575498], { icon: Mx }).addTo(map); //The Viktor Wynd Museum of Curiosities, Fine Art & UnNatural History

        L.marker([52.09001, 1.44888], { icon: Uf }).addTo(map); //ufp

        L.marker([52.93028, 0.87937], { icon: Hf }).addTo(map); // Warham Hillfort

        L.marker([52.04828, -0.0236], { icon: Mc }).addTo(map); // Royston cave

        L.marker([51.1784886, -1.8261453], { icon: Cm }).addTo(map); // Stone Henge

        L.marker([51.4403444, -1.7958463], { icon: Ss }).addTo(map); // Long Tom - standiong stone

        L.marker([57.3097388, -4.4389133], { icon: Sm }).addTo(map); // Loch Ness 'sea monster'
      };
    </script>
  </head>
  <body onload="setup()">
    <div id="map"></div>
  </body>
</html>
